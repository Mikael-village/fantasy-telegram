<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#007AFF">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Fantasy Dashboard</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icon-192.png">
    <link rel="stylesheet" href="/static/css/main.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <!-- Top Panel -->
    <div class="top-panel">
        <div class="top-date" id="currentDate"></div>
        <div class="status-indicators">
            <div class="status">
                <div class="status-dot online" id="pcDot"></div>
                <span>–°–µ—Ä–≤–µ—Ä</span>
            </div>
            <div class="status">
                <div class="status-dot online" id="aiDot"></div>
                <span>–ü–æ–º–æ—â–Ω–∏–∫</span>
            </div>
        </div>
    </div>

    <!-- Main Area -->
    <div class="main-area">
        <!-- Left Panel - Search services -->
        <div class="side-panel">
            <button class="side-btn" disabled title="–ó–∞–≥–ª—É—à–∫–∞ 1">‚ûä</button>
            <button class="side-btn" disabled title="–ó–∞–≥–ª—É—à–∫–∞ 2">‚ûã</button>
            <button class="side-btn" disabled title="–ó–∞–≥–ª—É—à–∫–∞ 3">‚ûå</button>
            <button class="side-btn" disabled title="–ó–∞–≥–ª—É—à–∫–∞ 4">‚ûç</button>
            <button class="side-btn" disabled title="–ó–∞–≥–ª—É—à–∫–∞ 5">‚ûé</button>
        </div>

        <!-- Center Zone -->
        <div class="center-zone">
            <!-- Empty state (default) -->
            <div class="content-view active" id="emptyView">
                <div class="empty-center">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª</div>
            </div>

            <!-- File browser -->
            <div class="content-view" id="fileBrowser">
                <div class="browser-header">
                    <button class="back-btn" onclick="goBack()">‚Üê</button>
                    <div class="current-path" id="currentPath"></div>
                </div>
                <div class="breadcrumb" id="fileBreadcrumb"></div>
                <div class="file-list" id="fileList"></div>
            </div>

            <!-- Downloads + Clients view -->
            <div class="content-view" id="downloadsView">
                <div class="folder-tabs">
                    <button class="folder-tab active" id="tabDownloads" onclick="switchTab('–ó–∞–≥—Ä—É–∑–∫–∏', this)">–ó–∞–≥—Ä—É–∑–∫–∏</button>
                    <button class="folder-tab" id="tabClients" onclick="switchTab('–ö–õ–ò–ï–ù–¢–´', this)">–ö–ª–∏–µ–Ω—Ç—ã</button>
                </div>
                <div class="breadcrumb" id="downloadsBreadcrumb"></div>
                <div class="file-list" id="downloadsFileList"></div>
            </div>

            <!-- AI Chat -->
            <div class="content-view" id="aiChatView">
                <div class="ai-chat-container">
                    <div class="ai-chat-header">
                        <button class="back-btn" onclick="closeView()">‚Üê</button>
                        <div class="ai-chat-title">üí¨ –ü–æ–º–æ—â–Ω–∏–∫</div>
                        <div class="ai-status" id="aiStatusIndicator">üü¢</div>
                    </div>
                    <div class="ai-chat-messages" id="aiChatMessages">
                        <div class="ai-message assistant">
                            <div class="message-content">–ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ–π AI-–ø–æ–º–æ—â–Ω–∏–∫. –ù–∞–∂–º–∏ –Ω–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω –∏ –≥–æ–≤–æ—Ä–∏ ‚Äî —è –æ—Ç–≤–µ—á—É –≥–æ–ª–æ—Å–æ–º –∏ —Ç–µ–∫—Å—Ç–æ–º.</div>
                        </div>
                    </div>
                    <div class="ai-chat-input">
                        <button class="voice-btn" id="voiceBtn" onclick="toggleVoiceInput()">
                            <span id="voiceIcon">üé§</span>
                        </button>
                        <input type="text" id="aiTextInput" placeholder="–ò–ª–∏ –Ω–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="handleAiInputKeypress(event)">
                        <button class="send-btn" onclick="sendAiMessage()">‚û§</button>
                    </div>
                </div>
            </div>

            <!-- CRM iframe -->
            <div class="content-view" id="crmView">
                <div class="iframe-view">
                    <div class="iframe-header">
                        <button class="back-btn" onclick="closeView()">‚Üê</button>
                        <div class="iframe-title">CRM</div>
                    </div>
                    <iframe class="iframe-content" id="crmIframe" src="about:blank"></iframe>
                </div>
            </div>

            <!-- Service iframe -->
            <div class="content-view" id="serviceView">
                <div class="iframe-view">
                    <div class="iframe-header">
                        <button class="back-btn" onclick="closeView()">‚Üê</button>
                        <div class="iframe-title" id="serviceTitle"></div>
                    </div>
                    <iframe class="iframe-content" id="serviceIframe" src="about:blank"></iframe>
                </div>
            </div>

            <!-- Helper view -->
            <div class="content-view" id="helperView">
                <div class="helper-view">
                    <div class="helper-avatar">ü§ñ</div>
                    
                    <div class="helper-slots">
                        <div class="slot-column">
                            <div class="slot">1</div>
                            <div class="slot">2</div>
                            <div class="slot">3</div>
                        </div>
                        <div style="width: 60px;"></div>
                        <div class="slot-column">
                            <div class="slot">4</div>
                            <div class="slot">5</div>
                            <div class="slot">6</div>
                        </div>
                    </div>

                    <div class="helper-buttons">
                        <button class="helper-btn" onclick="showFile('USER.md')">üìú –ü—Ä–∞–≤–∏–ª–∞</button>
                        <button class="helper-btn" onclick="showFile('AGENTS.md')">üìñ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞</button>
                    </div>

                    <div class="skills-section">
                        <div class="skills-title">–°–∫–∏–ª–ª—ã</div>
                        <input type="text" class="skills-search" id="skillsSearch" placeholder="üîç –ü–æ–∏—Å–∫ —Å–∫–∏–ª–ª–∞..." oninput="filterSkills(this.value)">
                        <div class="skills-categories" id="skillsCategories">
                            <div class="skill-item" style="color: var(--text-secondary)">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Loading -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
            </div>
        </div>

        <!-- Right Panel - Additional services -->
        <div class="side-panel">
            <button class="side-btn" disabled title="–ó–∞–≥–ª—É—à–∫–∞">‚¨ú</button>
            <button class="side-btn" onclick="openMessenger('Mail')" title="–ü–æ—á—Ç–∞"><img src="https://www.google.com/s2/favicons?domain=mail.ru&sz=32" alt="Mail"></button>
            <button class="side-btn" onclick="openMessenger('WhatsApp')" title="WhatsApp"><img src="https://www.google.com/s2/favicons?domain=whatsapp.com&sz=32" alt="WA"></button>
            <button class="side-btn" onclick="openMessenger('MAX')" title="MAX"><img src="/max-icon-small.png" alt="MAX"></button>
            <button class="side-btn" onclick="openMessenger('Telegram')" title="Telegram"><img src="https://www.google.com/s2/favicons?domain=telegram.org&sz=32" alt="TG"></button>
        </div>
    </div>

    <!-- File Actions Modal -->
    <div class="file-actions-modal" id="fileActionsModal" style="display:none" onclick="closeFileActions(event)">
        <div class="file-actions-content" onclick="event.stopPropagation()">
            <div class="file-actions-title" id="fileActionsTitle">file.txt</div>
            <button class="file-action-btn" onclick="fileActionOpen()">
                <span class="icon">üëÅÔ∏è</span> –û—Ç–∫—Ä—ã—Ç—å
            </button>
            <button class="file-action-btn" onclick="fileActionCopy()">
                <span class="icon">üìã</span> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
            </button>
            <button class="file-action-btn" onclick="fileActionDownload()">
                <span class="icon">üì•</span> –°–∫–∞—á–∞—Ç—å
            </button>
            <button class="file-action-btn file-action-cancel" onclick="closeFileActions()">
                –û—Ç–º–µ–Ω–∞
            </button>
        </div>
    </div>

    <!-- Clipboard indicator -->
    <div class="clipboard-indicator" id="clipboardIndicator">
        <span>üìã</span>
        <span id="clipboardFileName">–§–∞–π–ª —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω</span>
        <button onclick="clearClipboard()" style="background:none;border:none;color:white;font-size:16px;cursor:pointer">‚úï</button>
    </div>

    <!-- Messenger popup -->
    <div class="overlay" id="overlay" onclick="closeMessengerPopup()"></div>
    <div class="messenger-popup" id="messengerPopup">
        <div class="messenger-grid">
            <button class="messenger-btn" onclick="openMessenger('Mail')">
                <img src="https://upload.wikimedia.org/wikipedia/commons/4/4e/Mail_%28iOS%29.svg" alt="Mail">
            </button>
            <button class="messenger-btn" onclick="openMessenger('MAX')">
                <img src="/max-icon-small.png" alt="MAX">
            </button>
            <button class="messenger-btn" onclick="openMessenger('WhatsApp')">
                <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
            </button>
            <button class="messenger-btn" onclick="openMessenger('Telegram')">
                <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Telegram">
            </button>
        </div>
    </div>

    <!-- Bottom Panel -->
    <div class="bottom-panel">
        <div class="bottom-nav">
            <button class="nav-btn" onclick="openArchive()">
                <span class="nav-btn-icon">üóÑÔ∏è</span>
                <span class="nav-btn-label">–ê—Ä—Ö–∏–≤</span>
            </button>
            <button class="nav-btn" onclick="toggleMessengerPopup()">
                <span class="nav-btn-icon">üí¨</span>
                <span class="nav-btn-label">–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—ã</span>
            </button>
            <button class="nav-btn center" onclick="openAiChat()">
                <span class="nav-btn-icon">üé§</span>
                <span class="nav-btn-label">AI</span>
            </button>
            <button class="nav-btn" onclick="openHelper()">
                <span class="nav-btn-icon">ü§ñ</span>
                <span class="nav-btn-label">–ü–æ–º–æ—â–Ω–∏–∫</span>
            </button>
            <button class="nav-btn" onclick="openDownloads()">
                <span class="nav-btn-icon">üì•</span>
                <span class="nav-btn-label">–ó–∞–≥—Ä—É–∑–∫–∏</span>
            </button>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
    <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/sw.js", { updateViaCache: "none" })
        .then(reg => {
          reg.addEventListener("updatefound", () => {
            const newWorker = reg.installing;
            newWorker.addEventListener("statechange", () => {
              if (newWorker.state === "activated") {
                window.location.reload();
              }
            });
          });
        });
    }
    </script>
</body>
</html>
