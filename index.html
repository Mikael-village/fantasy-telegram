<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#007AFF">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Fantasy Dashboard</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icon-192.png">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #1a1a1a;
            --bg-secondary: #2a2a2a;
            --bg-tertiary: #3a3a3a;
            --text: #ffffff;
            --text-secondary: #888888;
            --accent: #007AFF;
            --accent-light: #4da3ff;
            --border: #404040;
            --success: #34C759;
            --danger: #FF3B30;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
        }

        /* ===== TOP PANEL - 60px ===== */
        .top-panel {
            height: 60px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            flex-shrink: 0;
        }

        .top-date {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .status-indicators {
            display: flex;
            gap: 16px;
        }

        .status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--danger);
        }

        .status-dot.online {
            background: var(--success);
        }

        /* ===== MAIN AREA ===== */
        .main-area {
            flex: 1;
            display: flex;
            position: relative;
            overflow: hidden;
            min-height: 0;
            margin-bottom: 120px; /* Space for fixed bottom panel */
        }

        /* ===== SIDE PANELS ===== */
        .side-panel {
            width: 52px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 8px;
            padding: 8px 6px;
            background: var(--bg-secondary);
            flex-shrink: 0;
        }

        .side-btn {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--bg-tertiary);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.15s;
            font-size: 16px;
        }

        .side-btn:active {
            transform: scale(0.92);
            background: var(--accent);
        }

        /* ===== CENTER ZONE ===== */
        .center-zone {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            background: var(--bg);
            min-height: 0; /* Important for flex scroll */
        }

        /* Content views */
        .content-view {
            display: none;
            flex-direction: column;
            flex: 1;
            overflow: hidden;
            min-height: 0; /* Important for flex scroll */
        }

        .content-view.active {
            display: flex;
        }

        /* Empty center */
        .empty-center {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* File Browser */
        .browser-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
        }

        .back-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: var(--bg-tertiary);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            color: var(--text);
        }

        .back-btn:active {
            background: var(--accent);
        }

        .current-path {
            flex: 1;
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .file-list {
            flex: 1 1 0;
            overflow-y: auto;
            overflow-x: hidden;
            min-height: 0;
            max-height: 100%;
            -webkit-overflow-scrolling: touch;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 14px 16px;
            gap: 14px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
        }

        .file-item:active {
            background: var(--bg-tertiary);
        }

        .file-icon {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            background: var(--bg-tertiary);
            flex-shrink: 0;
        }

        .file-icon.folder {
            background: var(--accent);
        }

        .file-info {
            flex: 1;
            min-width: 0;
        }

        .file-name {
            font-size: 15px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .file-meta {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        /* Iframe */
        .iframe-view {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .iframe-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
        }

        .iframe-title {
            flex: 1;
            font-size: 14px;
            font-weight: 500;
        }

        .iframe-content {
            flex: 1;
            border: none;
            background: white;
        }

        /* Helper view */
        .helper-view {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
            min-height: 0;
            -webkit-overflow-scrolling: touch;
        }

        .helper-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }

        .helper-slots {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .slot-column {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .slot {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            background: var(--bg-tertiary);
            border: 1px dashed var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .helper-buttons {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .helper-btn {
            padding: 10px 20px;
            border-radius: 8px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            color: var(--text);
            font-size: 13px;
            cursor: pointer;
        }

        .helper-btn:active {
            background: var(--accent);
        }

        .skills-section {
            margin-top: 16px;
        }

        .skills-title {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            text-transform: uppercase;
        }

        .skills-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .skill-item {
            padding: 12px;
            border-radius: 8px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            font-size: 13px;
            cursor: pointer;
        }

        .skill-item:active {
            border-color: var(--accent);
        }

        .skills-search {
            width: 100%;
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg-tertiary);
            color: var(--text);
            font-size: 14px;
            margin-bottom: 12px;
        }

        .skills-search::placeholder {
            color: var(--text-secondary);
        }

        .skills-categories {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .skill-category {
            background: var(--bg-secondary);
            border-radius: 10px;
            overflow: hidden;
        }

        .skill-category-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: var(--bg-tertiary);
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
        }

        .skill-category-header:active {
            background: var(--accent);
        }

        .skill-category-icon {
            font-size: 18px;
        }

        .skill-category-items {
            display: none;
            flex-direction: column;
        }

        .skill-category.expanded .skill-category-items {
            display: flex;
        }

        .skill-category-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            border-top: 1px solid var(--border);
            cursor: pointer;
            font-size: 13px;
        }

        .skill-category-item:active {
            background: var(--bg-tertiary);
        }

        .skill-category-item .skill-emoji {
            font-size: 16px;
        }

        .skill-category-item .skill-name {
            flex: 1;
        }

        .skill-category-item .skill-arrow {
            color: var(--text-secondary);
            font-size: 12px;
        }

        .skill-category-count {
            background: var(--accent);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            margin-left: auto;
        }

        /* Folder selector for Downloads view */
        .folder-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }

        .folder-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            background: var(--bg-secondary);
            border: none;
            cursor: pointer;
        }

        .folder-tab.active {
            color: var(--accent);
            border-bottom: 2px solid var(--accent);
        }

        /* Breadcrumb */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 10px 16px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            overflow-x: auto;
            flex-shrink: 0;
            -webkit-overflow-scrolling: touch;
        }

        .breadcrumb:empty {
            display: none;
        }

        .breadcrumb-item {
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 12px;
            color: var(--text-secondary);
            white-space: nowrap;
            cursor: pointer;
            background: var(--bg-tertiary);
        }

        .breadcrumb-item:active {
            background: var(--accent);
            color: white;
        }

        .breadcrumb-item.current {
            color: var(--accent);
            background: transparent;
            cursor: default;
        }

        .breadcrumb-sep {
            color: var(--text-secondary);
            font-size: 10px;
        }

        /* ===== BOTTOM PANEL - 120px (fixed) ===== */
        .bottom-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 120px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 12px 8px;
            z-index: 100;
        }

        .bottom-nav {
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
        }

        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 12px;
            border-radius: 12px;
            cursor: pointer;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            transition: all 0.15s;
        }

        .nav-btn:active {
            transform: scale(0.95);
        }

        .nav-btn.active {
            color: var(--accent);
        }

        .nav-btn-icon {
            font-size: 24px;
            margin-bottom: 4px;
        }

        .nav-btn-label {
            font-size: 10px;
            font-weight: 500;
        }

        /* Center CRM button - larger */
        .nav-btn.center {
            background: var(--accent);
            color: white;
            padding: 12px 24px;
            margin-bottom: 8px;
        }

        .nav-btn.center .nav-btn-icon {
            font-size: 28px;
        }

        /* Messenger popup */
        .messenger-popup {
            display: none;
            position: absolute;
            bottom: 130px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 12px;
            z-index: 100;
        }

        .messenger-popup.active {
            display: block;
        }

        .messenger-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .messenger-btn {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            background: var(--bg-tertiary);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            padding: 12px;
        }

        .messenger-btn:active {
            background: var(--accent);
        }

        .messenger-btn img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* Overlay */
        .overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 99;
        }

        .overlay.active {
            display: block;
        }

        /* Loading */
        .loading {
            display: none;
            position: absolute;
            inset: 0;
            background: rgba(26, 26, 26, 0.9);
            align-items: center;
            justify-content: center;
            z-index: 50;
        }

        .loading.active {
            display: flex;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Empty state */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        /* Text Modal */
        .text-modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            z-index: 200;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }

        .text-modal-content {
            background: var(--bg-secondary);
            border-radius: 12px;
            width: 100%;
            max-width: 600px;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .text-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            font-weight: 600;
            flex-shrink: 0;
        }

        .text-modal-header button {
            background: none;
            border: none;
            color: var(--text);
            font-size: 20px;
            cursor: pointer;
            padding: 4px 8px;
        }

        .text-modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            font-size: 13px;
            line-height: 1.5;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: monospace;
            color: var(--text);
            margin: 0;
            -webkit-overflow-scrolling: touch;
        }

        /* Image in modal */
        .text-modal-body img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }

        /* PDF iframe in modal */
        .text-modal-body iframe {
            width: 100%;
            height: 60vh;
            border: none;
            border-radius: 8px;
        }

        /* File Actions Modal */
        .file-actions-modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 200;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding: 16px;
        }

        .file-actions-content {
            background: var(--bg-secondary);
            border-radius: 16px 16px 0 0;
            width: 100%;
            max-width: 400px;
            padding: 16px;
        }

        .file-actions-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 16px;
            text-align: center;
            color: var(--text-secondary);
        }

        .file-action-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
            padding: 14px 16px;
            background: var(--bg-tertiary);
            border: none;
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            color: var(--text);
            font-size: 15px;
        }

        .file-action-btn:active {
            background: var(--accent);
        }

        .file-action-btn .icon {
            font-size: 20px;
        }

        .file-action-cancel {
            margin-top: 8px;
            background: transparent;
            color: var(--danger);
        }

        /* Clipboard indicator */
        .clipboard-indicator {
            position: fixed;
            bottom: 130px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 150;
            display: none;
        }

        .clipboard-indicator.active {
            display: flex;
            align-items: center;
            gap: 8px;
        }
    </style>
</head>
<body>
    <!-- Top Panel -->
    <div class="top-panel">
        <div class="top-date" id="currentDate"></div>
        <div class="status-indicators">
            <div class="status">
                <div class="status-dot online" id="pcDot"></div>
                <span>–°–µ—Ä–≤–µ—Ä</span>
            </div>
            <div class="status">
                <div class="status-dot online" id="aiDot"></div>
                <span>–ü–æ–º–æ—â–Ω–∏–∫</span>
            </div>
        </div>
    </div>

    <!-- Main Area -->
    <div class="main-area">
        <!-- Left Panel - Search services -->
        <div class="side-panel">
            <button class="side-btn" onclick="openService('https://brand-search.ru/', '–ü–æ–∏—Å–∫ –¢–ó', false)" title="brand-search.ru">üîç</button>
            <button class="side-btn" onclick="openService('https://linkmark.ru/', 'Linkmark', true)" title="linkmark.ru">üîó</button>
            <button class="side-btn" onclick="openService('https://www1.fips.ru/registers-web/action?acName=clickRegister&regName=RUTM', '–§–ò–ü–° –¢–ó', false)" title="–†–µ–µ—Å—Ç—Ä –¢–ó">üìã</button>
            <button class="side-btn" onclick="openService('https://www1.fips.ru/registers-web/action?acName=clickRegister&regName=RUTMAP', '–§–ò–ü–° –ó–∞—è–≤–∫–∏', false)" title="–†–µ–µ—Å—Ç—Ä –∑–∞—è–≤–æ–∫">üìù</button>
            <button class="side-btn" onclick="openService('https://www.pochta.ru/tracking', '–ü–æ—á—Ç–∞ –†–§', true)" title="–ü–æ—á—Ç–∞ –†–§">üì¶</button>
        </div>

        <!-- Center Zone -->
        <div class="center-zone">
            <!-- Empty state (default) -->
            <div class="content-view active" id="emptyView">
                <div class="empty-center">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª</div>
            </div>

            <!-- File browser -->
            <div class="content-view" id="fileBrowser">
                <div class="browser-header">
                    <button class="back-btn" onclick="goBack()">‚Üê</button>
                    <div class="current-path" id="currentPath"></div>
                </div>
                <div class="breadcrumb" id="fileBreadcrumb"></div>
                <div class="file-list" id="fileList"></div>
            </div>

            <!-- Downloads + Clients view -->
            <div class="content-view" id="downloadsView">
                <div class="folder-tabs">
                    <button class="folder-tab active" id="tabDownloads" onclick="switchTab('–ó–∞–≥—Ä—É–∑–∫–∏', this)">–ó–∞–≥—Ä—É–∑–∫–∏</button>
                    <button class="folder-tab" id="tabClients" onclick="switchTab('–ö–õ–ò–ï–ù–¢–´', this)">–ö–ª–∏–µ–Ω—Ç—ã</button>
                </div>
                <div class="breadcrumb" id="downloadsBreadcrumb"></div>
                <div class="file-list" id="downloadsFileList"></div>
            </div>

            <!-- CRM iframe -->
            <div class="content-view" id="crmView">
                <div class="iframe-view">
                    <div class="iframe-header">
                        <button class="back-btn" onclick="closeView()">‚Üê</button>
                        <div class="iframe-title">CRM</div>
                    </div>
                    <iframe class="iframe-content" id="crmIframe" src="about:blank"></iframe>
                </div>
            </div>

            <!-- Service iframe -->
            <div class="content-view" id="serviceView">
                <div class="iframe-view">
                    <div class="iframe-header">
                        <button class="back-btn" onclick="closeView()">‚Üê</button>
                        <div class="iframe-title" id="serviceTitle"></div>
                    </div>
                    <iframe class="iframe-content" id="serviceIframe" src="about:blank"></iframe>
                </div>
            </div>

            <!-- Helper view -->
            <div class="content-view" id="helperView">
                <div class="helper-view">
                    <div class="helper-avatar">ü§ñ</div>
                    
                    <div class="helper-slots">
                        <div class="slot-column">
                            <div class="slot">1</div>
                            <div class="slot">2</div>
                            <div class="slot">3</div>
                        </div>
                        <div style="width: 60px;"></div>
                        <div class="slot-column">
                            <div class="slot">4</div>
                            <div class="slot">5</div>
                            <div class="slot">6</div>
                        </div>
                    </div>

                    <div class="helper-buttons">
                        <button class="helper-btn" onclick="showFile('USER.md')">üìú –ü—Ä–∞–≤–∏–ª–∞</button>
                        <button class="helper-btn" onclick="showFile('AGENTS.md')">üìñ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞</button>
                    </div>

                    <div class="skills-section">
                        <div class="skills-title">–°–∫–∏–ª–ª—ã</div>
                        <input type="text" class="skills-search" id="skillsSearch" placeholder="üîç –ü–æ–∏—Å–∫ —Å–∫–∏–ª–ª–∞..." oninput="filterSkills(this.value)">
                        <div class="skills-categories" id="skillsCategories">
                            <div class="skill-item" style="color: var(--text-secondary)">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Loading -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
            </div>
        </div>

        <!-- Right Panel - Additional services -->
        <div class="side-panel">
            <button class="side-btn" onclick="openService('https://www1.fips.ru/registers-web/', '–§–ò–ü–°', false)" title="–í—Å–µ —Ä–µ–µ—Å—Ç—Ä—ã">üèõÔ∏è</button>
            <button class="side-btn" onclick="alert('–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')" title="–ò–∑–±—Ä–∞–Ω–Ω–æ–µ">‚≠ê</button>
            <button class="side-btn" onclick="alert('–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')" title="–ù–µ–¥–∞–≤–Ω–∏–µ">üïê</button>
            <button class="side-btn" onclick="alert('–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')" title="–ü–æ–∏—Å–∫">üîé</button>
            <button class="side-btn" onclick="alert('–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
        </div>
    </div>

    <!-- File Actions Modal -->
    <div class="file-actions-modal" id="fileActionsModal" style="display:none" onclick="closeFileActions(event)">
        <div class="file-actions-content" onclick="event.stopPropagation()">
            <div class="file-actions-title" id="fileActionsTitle">file.txt</div>
            <button class="file-action-btn" onclick="fileActionOpen()">
                <span class="icon">üëÅÔ∏è</span> –û—Ç–∫—Ä—ã—Ç—å
            </button>
            <button class="file-action-btn" onclick="fileActionCopy()">
                <span class="icon">üìã</span> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
            </button>
            <button class="file-action-btn" onclick="fileActionDownload()">
                <span class="icon">üì•</span> –°–∫–∞—á–∞—Ç—å
            </button>
            <button class="file-action-btn file-action-cancel" onclick="closeFileActions()">
                –û—Ç–º–µ–Ω–∞
            </button>
        </div>
    </div>

    <!-- Clipboard indicator -->
    <div class="clipboard-indicator" id="clipboardIndicator">
        <span>üìã</span>
        <span id="clipboardFileName">–§–∞–π–ª —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω</span>
        <button onclick="clearClipboard()" style="background:none;border:none;color:white;font-size:16px;cursor:pointer">‚úï</button>
    </div>

    <!-- Messenger popup -->
    <div class="overlay" id="overlay" onclick="closeMessengerPopup()"></div>
    <div class="messenger-popup" id="messengerPopup">
        <div class="messenger-grid">
            <!-- Left top: Mail, Right top: MAX -->
            <!-- Left bottom: WhatsApp, Right bottom: Telegram -->
            <button class="messenger-btn" onclick="openMessenger('Mail')">
                <img src="https://upload.wikimedia.org/wikipedia/commons/4/4e/Mail_%28iOS%29.svg" alt="Mail">
            </button>
            <button class="messenger-btn" onclick="openMessenger('MAX')">
                <img src="https://upload.wikimedia.org/wikipedia/commons/2/21/VK.com-logo.svg" alt="MAX">
            </button>
            <button class="messenger-btn" onclick="openMessenger('WhatsApp')">
                <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
            </button>
            <button class="messenger-btn" onclick="openMessenger('Telegram')">
                <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Telegram">
            </button>
        </div>
    </div>

    <!-- Bottom Panel -->
    <div class="bottom-panel">
        <div class="bottom-nav">
            <button class="nav-btn" onclick="openArchive()">
                <span class="nav-btn-icon">üóÑÔ∏è</span>
                <span class="nav-btn-label">–ê—Ä—Ö–∏–≤</span>
            </button>
            <button class="nav-btn" onclick="toggleMessengerPopup()">
                <span class="nav-btn-icon">üí¨</span>
                <span class="nav-btn-label">–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—ã</span>
            </button>
            <button class="nav-btn center" onclick="openCRM()">
                <span class="nav-btn-icon">üìä</span>
                <span class="nav-btn-label">CRM</span>
            </button>
            <button class="nav-btn" onclick="openHelper()">
                <span class="nav-btn-icon">ü§ñ</span>
                <span class="nav-btn-label">–ü–æ–º–æ—â–Ω–∏–∫</span>
            </button>
            <button class="nav-btn" onclick="openDownloads()">
                <span class="nav-btn-icon">üì•</span>
                <span class="nav-btn-label">–ó–∞–≥—Ä—É–∑–∫–∏</span>
            </button>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        let currentPath = '';
        let pathHistory = [];
        let currentRootPath = '';
        let openedWindows = {};
        
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        const messengerLinks = {
            'Telegram': { web: 'https://web.telegram.org/', app: 'tg://resolve' },
            'MAX': { web: 'https://web.max.ru/', app: null },
            'WhatsApp': { web: 'https://web.whatsapp.com/', app: 'whatsapp://send' },
            'Mail': { web: 'https://e.mail.ru/inbox/', app: 'mailto:' }
        };

        // ===== INIT =====
        document.addEventListener('DOMContentLoaded', () => {
            updateDate();
            setInterval(updateDate, 60000);
            
            if (window.Telegram?.WebApp) {
                Telegram.WebApp.ready();
                Telegram.WebApp.expand();
            }
        });

        function updateDate() {
            const now = new Date();
            const options = { day: 'numeric', month: 'long', year: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('ru-RU', options);
        }

        // ===== VIEW MANAGEMENT =====
        function showView(viewId) {
            document.querySelectorAll('.content-view').forEach(v => v.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
        }

        function closeView() {
            showView('emptyView');
            // CRM iframe –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–µ—Å—Å–∏—é
            document.getElementById('serviceIframe').src = 'about:blank';
        }

        // ===== BOTTOM NAV ACTIONS =====
        function openArchive() {
            currentRootPath = '–ê–†–•–ò–í';
            openFolder('–ê–†–•–ò–í');
        }

        function openDownloads() {
            showView('downloadsView');
            loadDownloadsTab('–ó–∞–≥—Ä—É–∑–∫–∏');
        }

        function openCRM() {
            showView('crmView');
            document.getElementById('crmIframe').src = 'https://crm.rko.center/leads';
        }

        function openHelper() {
            showView('helperView');
            loadSkills();
        }

        // ===== MESSENGER POPUP =====
        function toggleMessengerPopup() {
            const popup = document.getElementById('messengerPopup');
            const overlay = document.getElementById('overlay');
            popup.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        function closeMessengerPopup() {
            document.getElementById('messengerPopup').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }

        function openMessenger(name) {
            closeMessengerPopup();
            const links = messengerLinks[name];
            if (!links) return;
            
            if (isMobile && links.app) {
                window.location.href = links.app;
            } else {
                window.open(links.web, '_blank');
            }
        }

        // ===== SERVICES =====
        function openService(url, name, canIframe) {
            if (canIframe && !isMobile) {
                showView('serviceView');
                document.getElementById('serviceTitle').textContent = name;
                document.getElementById('serviceIframe').src = url;
            } else {
                window.open(url, '_blank');
            }
        }

        // ===== FILE BROWSER =====
        let archiveRootPath = '–ê–†–•–ò–í';

        async function openFolder(path) {
            showLoading(true);
            currentPath = path;
            pathHistory.push(path);

            try {
                const response = await fetch(`${API_BASE}/api/pc/files?path=${encodeURIComponent(path)}`);
                const data = await response.json();

                if (data.error) {
                    alert(data.pc_online === false ? '–ü–ö –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω' : '–û—à–∏–±–∫–∞: ' + data.error);
                    showLoading(false);
                    return;
                }

                renderFiles(data.items || [], 'fileList');
                document.getElementById('currentPath').textContent = path.split('/').pop() || path;
                updateFileBreadcrumb();
                showView('fileBrowser');
            } catch (e) {
                alert('–û—à–∏–±–∫–∞: ' + e.message);
            }

            showLoading(false);
        }

        function updateFileBreadcrumb() {
            const bc = document.getElementById('fileBreadcrumb');
            const relativePath = currentPath.replace(archiveRootPath, '').replace(/^\//, '');
            
            if (!relativePath) {
                bc.innerHTML = '';
                return;
            }

            const parts = relativePath.split('/').filter(p => p);
            let html = `<span class="breadcrumb-item" onclick="openFolder('${archiveRootPath}')">üóÑÔ∏è –ê—Ä—Ö–∏–≤</span>`;
            
            let buildPath = archiveRootPath;
            parts.forEach((part, i) => {
                buildPath += '/' + part;
                const isLast = i === parts.length - 1;
                html += `<span class="breadcrumb-sep">‚Ä∫</span>`;
                if (isLast) {
                    html += `<span class="breadcrumb-item current">${part}</span>`;
                } else {
                    html += `<span class="breadcrumb-item" onclick="openFolder('${buildPath}')">${part}</span>`;
                }
            });

            bc.innerHTML = html;
        }

        function goBack() {
            pathHistory.pop();
            if (pathHistory.length > 0) {
                const prev = pathHistory.pop();
                openFolder(prev);
            } else {
                closeView();
            }
        }

        // ===== DOWNLOADS TAB =====
        let downloadsCurrentPath = '';
        let downloadsRootPath = '';

        function switchTab(folder, btn) {
            document.querySelectorAll('.folder-tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            downloadsRootPath = folder;
            loadDownloadsFolder(folder);
        }

        async function loadDownloadsFolder(folder) {
            showLoading(true);
            downloadsCurrentPath = folder;

            try {
                const response = await fetch(`${API_BASE}/api/pc/files?path=${encodeURIComponent(folder)}`);
                const data = await response.json();

                if (data.error) {
                    document.getElementById('downloadsFileList').innerHTML = 
                        `<div class="empty-state"><span class="empty-state-icon">‚ö†Ô∏è</span><span>${data.error}</span></div>`;
                } else {
                    renderDownloadsFiles(data.items || []);
                    updateBreadcrumb();
                }
            } catch (e) {
                document.getElementById('downloadsFileList').innerHTML = 
                    `<div class="empty-state"><span class="empty-state-icon">‚ö†Ô∏è</span><span>${e.message}</span></div>`;
            }

            showLoading(false);
        }

        function renderDownloadsFiles(items) {
            const list = document.getElementById('downloadsFileList');
            list.innerHTML = '';

            if (items.length === 0) {
                list.innerHTML = '<div class="empty-state"><span class="empty-state-icon">üì≠</span><span>–ü—É—Å—Ç–æ</span></div>';
                return;
            }

            items.forEach(file => {
                const isFolder = file.type === 'folder';
                const item = document.createElement('div');
                item.className = 'file-item';
                item.onclick = () => {
                    if (isFolder) {
                        loadDownloadsFolder(downloadsCurrentPath + '/' + file.name);
                    } else {
                        showFileActions(downloadsCurrentPath + '/' + file.name, file.name);
                    }
                };

                item.innerHTML = `
                    <div class="file-icon ${isFolder ? 'folder' : ''}">${isFolder ? 'üìÅ' : getFileIcon(file.name)}</div>
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-meta">${isFolder ? '–ü–∞–ø–∫–∞' : formatSize(file.size || 0)}</div>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        function updateBreadcrumb() {
            const bc = document.getElementById('downloadsBreadcrumb');
            
            // –†–∞–∑–±–∏–≤–∞–µ–º –ø—É—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–æ—Ä–Ω—è
            const relativePath = downloadsCurrentPath.replace(downloadsRootPath, '').replace(/^\//, '');
            
            if (!relativePath) {
                bc.innerHTML = '';
                return;
            }

            const parts = relativePath.split('/').filter(p => p);
            let html = `<span class="breadcrumb-item" onclick="loadDownloadsFolder('${downloadsRootPath}')">${downloadsRootPath === '–ó–∞–≥—Ä—É–∑–∫–∏' ? 'üì•' : 'üë•'} –ö–æ—Ä–µ–Ω—å</span>`;
            
            let buildPath = downloadsRootPath;
            parts.forEach((part, i) => {
                buildPath += '/' + part;
                const isLast = i === parts.length - 1;
                html += `<span class="breadcrumb-sep">‚Ä∫</span>`;
                if (isLast) {
                    html += `<span class="breadcrumb-item current">${part}</span>`;
                } else {
                    html += `<span class="breadcrumb-item" onclick="loadDownloadsFolder('${buildPath}')">${part}</span>`;
                }
            });

            bc.innerHTML = html;
        }

        async function loadDownloadsTab(folder) {
            downloadsRootPath = folder;
            loadDownloadsFolder(folder);
        }

        function renderFiles(items, listId, basePath = currentPath) {
            const list = document.getElementById(listId);
            list.innerHTML = '';

            if (items.length === 0) {
                list.innerHTML = '<div class="empty-state"><span class="empty-state-icon">üì≠</span><span>–ü—É—Å—Ç–æ</span></div>';
                return;
            }

            items.forEach(file => {
                const isFolder = file.type === 'folder';
                const item = document.createElement('div');
                item.className = 'file-item';
                item.onclick = () => {
                    if (isFolder) {
                        openFolder(basePath + '/' + file.name);
                    } else {
                        showFileActions(basePath + '/' + file.name, file.name);
                    }
                };

                item.innerHTML = `
                    <div class="file-icon ${isFolder ? 'folder' : ''}">${isFolder ? 'üìÅ' : getFileIcon(file.name)}</div>
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-meta">${isFolder ? '–ü–∞–ø–∫–∞' : formatSize(file.size || 0)}</div>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        // ===== HELPER =====
        async function showFile(filename) {
            showLoading(true);
            try {
                // –ü—É—Ç—å –∫ —Ñ–∞–π–ª–∞–º –≤ Jarvis.Dom
                const basePath = 'Jarvis.Mir/Jarvis.Dom';
                const response = await fetch(`${API_BASE}/api/pc/file?path=${encodeURIComponent(basePath + '/' + filename)}`);
                const data = await response.json();
                
                if (data.error) {
                    alert('–û—à–∏–±–∫–∞: ' + data.error);
                } else if (data.content) {
                    showTextContent(filename, data.content);
                } else {
                    alert('–§–∞–π–ª –ø—É—Å—Ç –∏–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
            } catch (e) {
                alert('–û—à–∏–±–∫–∞: ' + e.message);
            }
            showLoading(false);
        }

        function showTextContent(title, content) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
            const modal = document.createElement('div');
            modal.className = 'text-modal';
            modal.innerHTML = `
                <div class="text-modal-content">
                    <div class="text-modal-header">
                        <span>${title}</span>
                        <button onclick="this.closest('.text-modal').remove()">‚úï</button>
                    </div>
                    <pre class="text-modal-body">${escapeHtml(content)}</pre>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // –ö–∞—Ç–∞–ª–æ–≥ —Å–∫–∏–ª–ª–æ–≤ —Å —Ä—É—Å—Å–∫–∏–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
        const skillsCatalog = {
            'üìã –î–æ–∫—É–º–µ–Ω—Ç—ã': [
                { id: 'new-contract', name: '–ù–æ–≤—ã–π –¥–æ–≥–æ–≤–æ—Ä', emoji: 'üìù', triggers: '–Ω–æ–≤—ã–π –¥–æ–≥–æ–≤–æ—Ä, –ø–æ–¥–≥–æ—Ç–æ–≤—å –¥–æ–≥–æ–≤–æ—Ä' },
                { id: 'contracts-brandonline', name: '–°–∏—Å—Ç–µ–º–∞ –¥–æ–≥–æ–≤–æ—Ä–æ–≤', emoji: 'üìë', triggers: '–¥–æ–≥–æ–≤–æ—Ä –†–¢–ó, –¥–æ–≥–æ–≤–æ—Ä –Ω–∞ –ª–æ–≥–æ, –ö–ü' },
            ],
            'üíº CRM': [
                { id: 'bitrix-assistant', name: '–ë–∏—Ç—Ä–∏–∫—Å CRM', emoji: 'üî∂', triggers: '–±–∏—Ç—Ä–∏–∫—Å, –¥–µ–ª–∞, –∫–æ–º–ø–∞–Ω–∏–∏' },
                { id: 'mcrm', name: 'MCRM (–Ω–æ–≤–∞—è)', emoji: 'üìä', triggers: 'MCRM, –º–∏–≥—Ä–∞—Ü–∏—è' },
            ],
            'üí¨ –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—ã': [
                { id: 'messenger-telegram', name: '–¢–µ–ª–µ–≥—Ä–∞–º', emoji: '‚úàÔ∏è', triggers: '–Ω–∞–ø–∏—à–∏ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º' },
                { id: 'messenger-whatsapp', name: 'WhatsApp', emoji: 'üíö', triggers: '–Ω–∞–ø–∏—à–∏ –≤ whatsapp' },
                { id: 'messenger-max', name: 'MAX (VK)', emoji: 'üíô', triggers: '–Ω–∞–ø–∏—à–∏ –≤ max' },
            ],
            'üèõÔ∏è –†–æ—Å–ø–∞—Ç–µ–Ω—Ç': [
                { id: 'fips-expertise', name: '–≠–∫—Å–ø–µ—Ä—Ç–∏–∑–∞ –§–ò–ü–°', emoji: 'üìã', triggers: '–æ—Ç–≤–µ—Ç –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, –æ—Å–Ω–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–∞–∑–∞' },
                { id: 'fips-monitor', name: '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞—è–≤–æ–∫', emoji: 'üëÅÔ∏è', triggers: '–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞—è–≤–∫—É, —Å—Ç–∞—Ç—É—Å' },
            ],
            'üîß –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è': [
                { id: 'desktop-control', name: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ü–ö', emoji: 'üñ•Ô∏è', triggers: '–∫–ª–∏–∫–Ω–∏, –Ω–∞–∂–º–∏, –≤–≤–µ–¥–∏' },
                { id: 'macro-recorder', name: '–ó–∞–ø–∏—Å—å –º–∞–∫—Ä–æ—Å–æ–≤', emoji: '‚è∫Ô∏è', triggers: '–∑–∞–ø–∏—à–∏ –º–∞–∫—Ä–æ—Å' },
                { id: 'windows-apps', name: '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è Windows', emoji: 'ü™ü', triggers: '—Å–æ–∑–¥–∞–π –ø—Ä–æ–≥—Ä–∞–º–º—É' },
            ],
            'üîç –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ': [
                { id: 'site-research', name: '–ò–∑—É—á–µ–Ω–∏–µ —Å–∞–π—Ç–∞', emoji: 'üåê', triggers: '–∏–∑—É—á–∏ —Å–∞–π—Ç' },
                { id: 'service-onboarding', name: '–û–Ω–±–æ—Ä–¥–∏–Ω–≥ —Å–µ—Ä–≤–∏—Å–∞', emoji: 'üéì', triggers: '–∏–∑—É—á–∏ —Å–µ—Ä–≤–∏—Å, —Ä–∞–∑–±–µ—Ä–∏—Å—å' },
            ],
            '‚öôÔ∏è –°–∏—Å—Ç–µ–º–∞': [
                { id: 'system-architecture', name: '–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∞–≤–∏–ª', emoji: 'üèóÔ∏è', triggers: '–∑–∞—Ñ–∏–∫—Å–∏—Ä—É–π, –∑–∞–ø–æ–º–Ω–∏' },
                { id: 'skill-creator', name: '–°–æ–∑–¥–∞–Ω–∏–µ —Å–∫–∏–ª–ª–æ–≤', emoji: '‚ú®', triggers: '—Å–æ–∑–¥–∞–π —Å–∫–∏–ª–ª' },
                { id: 'self-improvement', name: '–°–∞–º–æ—É–ª—É—á—à–µ–Ω–∏–µ', emoji: 'üìà', triggers: '–ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏, —Ä–µ—Ñ–ª–µ–∫—Å–∏—è' },
                { id: 'execution-discipline', name: '–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è', emoji: '‚úÖ', triggers: '—Å–ª–æ–∂–Ω–∞—è –∑–∞–¥–∞—á–∞' },
                { id: 'context-save', name: '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞', emoji: 'üíæ', triggers: '—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç' },
                { id: 'workspace-structure', name: '–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫', emoji: 'üìÅ', triggers: '–Ω–∞–π–¥–∏ —Ñ–∞–π–ª, –≥–¥–µ –ª–µ–∂–∏—Ç' },
            ],
            'üñ•Ô∏è –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞': [
                { id: 'firstvds', name: 'VPS —Å–µ—Ä–≤–µ—Ä', emoji: 'üñß', triggers: '–¥–µ–ø–ª–æ–π –Ω–∞ VPS, FirstVDS' },
                { id: 'fantasy-dashboard', name: 'Fantasy Dashboard', emoji: 'üéÆ', triggers: 'fantasy, —Ñ—ç–Ω—Ç–µ–∑–∏' },
            ],
        };

        let allSkills = []; // –î–ª—è –ø–æ–∏—Å–∫–∞

        async function loadSkills() {
            const container = document.getElementById('skillsCategories');
            container.innerHTML = '';
            allSkills = [];

            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —Å–∫–∏–ª–ª—ã –¥–ª—è –ø–æ–∏—Å–∫–∞
            Object.entries(skillsCatalog).forEach(([category, skills]) => {
                skills.forEach(skill => {
                    allSkills.push({ ...skill, category });
                });
            });

            // –†–µ–Ω–¥–µ—Ä–∏–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            Object.entries(skillsCatalog).forEach(([category, skills]) => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'skill-category';
                categoryDiv.innerHTML = `
                    <div class="skill-category-header" onclick="toggleCategory(this)">
                        <span class="skill-category-icon">${category.split(' ')[0]}</span>
                        <span>${category.split(' ').slice(1).join(' ')}</span>
                        <span class="skill-category-count">${skills.length}</span>
                    </div>
                    <div class="skill-category-items">
                        ${skills.map(skill => `
                            <div class="skill-category-item" onclick="openSkill('${skill.id}')">
                                <span class="skill-emoji">${skill.emoji}</span>
                                <span class="skill-name">${skill.name}</span>
                                <span class="skill-arrow">‚Ä∫</span>
                            </div>
                        `).join('')}
                    </div>
                `;
                container.appendChild(categoryDiv);
            });
        }

        function toggleCategory(header) {
            const category = header.parentElement;
            category.classList.toggle('expanded');
        }

        function filterSkills(query) {
            const container = document.getElementById('skillsCategories');
            query = query.toLowerCase().trim();

            if (!query) {
                loadSkills();
                return;
            }

            // –§–∏–ª—å—Ç—Ä—É–µ–º —Å–∫–∏–ª–ª—ã
            const filtered = allSkills.filter(skill => 
                skill.name.toLowerCase().includes(query) ||
                skill.triggers.toLowerCase().includes(query) ||
                skill.id.toLowerCase().includes(query)
            );

            container.innerHTML = '';

            if (filtered.length === 0) {
                container.innerHTML = '<div class="skill-item" style="color: var(--text-secondary)">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                return;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
            filtered.forEach(skill => {
                const div = document.createElement('div');
                div.className = 'skill-category-item';
                div.style.background = 'var(--bg-secondary)';
                div.style.borderRadius = '8px';
                div.style.marginBottom = '8px';
                div.style.border = '1px solid var(--border)';
                div.onclick = () => openSkill(skill.id);
                div.innerHTML = `
                    <span class="skill-emoji">${skill.emoji}</span>
                    <span class="skill-name">${skill.name}</span>
                    <span class="skill-arrow">‚Ä∫</span>
                `;
                container.appendChild(div);
            });
        }

        async function openSkill(skillName) {
            showLoading(true);
            try {
                const response = await fetch(`${API_BASE}/api/pc/file?path=${encodeURIComponent('Jarvis.Mir/Jarvis.Dom/skills/' + skillName + '/SKILL.md')}`);
                const data = await response.json();
                
                if (data.content) {
                    showTextContent(skillName + '/SKILL.md', data.content);
                } else {
                    alert('SKILL.md –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
            } catch (e) {
                alert('–û—à–∏–±–∫–∞: ' + e.message);
            }
            showLoading(false);
        }

        function showSkillGroup(group) {
            alert(`–ì—Ä—É–ø–ø–∞ —Å–∫–∏–ª–ª–æ–≤: ${group}\n(–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)`);
        }

        // ===== FILE ACTIONS =====
        let selectedFile = null;
        let clipboardFile = null;

        function showFileActions(path, filename) {
            selectedFile = { path, filename };
            document.getElementById('fileActionsTitle').textContent = filename;
            document.getElementById('fileActionsModal').style.display = 'flex';
        }

        function closeFileActions(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('fileActionsModal').style.display = 'none';
            selectedFile = null;
        }

        async function fileActionOpen() {
            const file = selectedFile; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–æ –∑–∞–∫—Ä—ã—Ç–∏—è
            closeFileActions();
            if (!file) {
                alert('–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω');
                return;
            }
            
            const ext = file.filename.split('.').pop().toLowerCase();
            const textExts = ['txt', 'md', 'json', 'js', 'py', 'html', 'css', 'xml', 'yaml', 'yml', 'log', 'bat', 'sh', 'ini', 'cfg', 'env', 'gitignore', 'docx', 'odt', 'doc'];
            const imageExts = ['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp', 'svg'];
            
            showLoading(true);
            
            try {
                if (textExts.includes(ext) || file.filename.startsWith('.')) {
                    // –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª - —á–∏—Ç–∞–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º
                    const url = `${API_BASE}/api/pc/file?path=${encodeURIComponent(file.path)}`;
                    console.log('Fetching:', url);
                    const response = await fetch(url);
                    const data = await response.json();
                    console.log('Response:', data);
                    
                    if (data.content) {
                        showTextContent(file.filename, data.content);
                    } else if (data.error) {
                        alert('–û—à–∏–±–∫–∞: ' + data.error);
                    } else {
                        alert('–§–∞–π–ª –ø—É—Å—Ç –∏–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å');
                    }
                } else if (imageExts.includes(ext)) {
                    // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ - –∑–∞–≥—Ä—É–∂–∞–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º
                    const url = `${API_BASE}/api/pc/file/download?path=${encodeURIComponent(file.path)}`;
                    showImagePreview(file.filename, url);
                } else if (ext === 'pdf') {
                    // PDF - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ iframe
                    const url = `${API_BASE}/api/pc/file/download?path=${encodeURIComponent(file.path)}`;
                    showPdfPreview(file.filename, url);
                } else {
                    // –û—Å—Ç–∞–ª—å–Ω—ã–µ - —Å–∫–∞—á–∏–≤–∞–µ–º
                    alert('–§–æ—Ä–º–∞—Ç ' + ext + ' –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞. –°–∫–∞—á–∏–≤–∞—é...');
                    downloadFile(file.path, file.filename);
                }
            } catch (e) {
                console.error('Error:', e);
                alert('–û—à–∏–±–∫–∞: ' + e.message);
            }
            
            showLoading(false);
        }

        function fileActionCopy() {
            const file = selectedFile;
            closeFileActions();
            if (!file) return;
            
            clipboardFile = { ...file };
            document.getElementById('clipboardFileName').textContent = file.filename;
            document.getElementById('clipboardIndicator').classList.add('active');
        }

        function clearClipboard() {
            clipboardFile = null;
            document.getElementById('clipboardIndicator').classList.remove('active');
        }

        function fileActionDownload() {
            const file = selectedFile;
            closeFileActions();
            if (!file) return;
            downloadFile(file.path, file.filename);
        }

        function downloadFile(path, filename) {
            const url = `${API_BASE}/api/pc/file/download?path=${encodeURIComponent(path)}`;
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.target = '_blank';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function showImagePreview(title, url) {
            const modal = document.createElement('div');
            modal.className = 'text-modal';
            modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
            modal.innerHTML = `
                <div class="text-modal-content">
                    <div class="text-modal-header">
                        <span>${title}</span>
                        <button onclick="this.closest('.text-modal').remove()">‚úï</button>
                    </div>
                    <div class="text-modal-body" style="text-align:center;padding:8px;">
                        <img src="${url}" alt="${title}" style="max-height:70vh;">
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showPdfPreview(title, url) {
            const modal = document.createElement('div');
            modal.className = 'text-modal';
            modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
            modal.innerHTML = `
                <div class="text-modal-content" style="max-width:90%;height:85vh;">
                    <div class="text-modal-header">
                        <span>${title}</span>
                        <button onclick="this.closest('.text-modal').remove()">‚úï</button>
                    </div>
                    <div class="text-modal-body" style="padding:0;flex:1;">
                        <iframe src="${url}" style="width:100%;height:100%;"></iframe>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // ===== HELPERS =====
        function showLoading(show) {
            document.getElementById('loading').classList.toggle('active', show);
        }

        function getFileIcon(name) {
            const ext = name.split('.').pop().toLowerCase();
            const icons = {
                pdf: 'üìï', doc: 'üìÑ', docx: 'üìÑ', xls: 'üìä', xlsx: 'üìä',
                jpg: 'üñºÔ∏è', jpeg: 'üñºÔ∏è', png: 'üñºÔ∏è', gif: 'üñºÔ∏è',
                zip: 'üì¶', rar: 'üì¶', mp3: 'üéµ', mp4: 'üé¨', txt: 'üìù'
            };
            return icons[ext] || 'üìÑ';
        }

        function formatSize(bytes) {
            if (!bytes) return '';
            const k = 1024, sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        // ===== PWA SERVICE WORKER =====
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(reg => console.log('SW registered'))
                .catch(err => console.log('SW error:', err));
        }
    </script>
</body>
</html>
